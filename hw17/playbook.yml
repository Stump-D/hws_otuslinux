---
- name:  install needed network manager libs
  hosts: all
  become: yes
  vars:
    net_libs: NetworkManager-glib
  tasks:
    - name: install needed network manager libs
      yum:
        name: "{{ net_libs }}"
        state: installed
      with_items:
        - NetworkManager-glib
        - libnm-qt-devel.x86_64
        - nm-connection-editor.x86_64
        - libsemanage-python
        - policycoreutils-python


- name:  Isolated Config| testClients & testServers Network Configuration
  hosts: Isolated
  become: yes
  tasks:
    - name: Try to set vlan&ip 
      shell:
        nmcli con add type vlan con-name "{{  vlan_name  }}"  dev eth1 id "{{  vlan_id  }}" ip4 "{{  ip4addr  }}"     
      tags:
        - set-client-vlan-ip
      notify:
        - restart_network
        - reload_network_interface
  handlers:
    - include: handlers/restart_network.yml
    - include: handlers/reload_network_interface.yml
      
- name:  Routers Config| Routers Network Configuration
  hosts: Routers
  become: yes
  vars:
    team: Team0
    nmcli_team_slave:
      - conn_name: eth1
        ifname: eth1
        master: "{{ team }}"
      - conn_name: eth2
        ifname: eth2
        master: "{{ team }}"
  tasks:
    - name: Add a Team connection with static IP configuration
      nmcli:
        type: team
        mode: active-backup
        conn_name: "{{  team }}"
        ip4: '{{ ip4addr }}'
        state: present
     
    - name: Try to set runner for Team0 
      shell:
        nmcli connection modify "{{ team }}" team.runner activebackup   
      tags:
        - set-team-mode
      notify:
        - restart_network
        - reload_network_interface
        
    - name: Try nmcli add team-slave
      nmcli:
        type: team-slave
        conn_name: '{{ item.conn_name }}'
        ifname: '{{ item.ifname }}'
        master: '{{ item.master }}'
        state: present
      with_items:
        - '{{ nmcli_team_slave }}'
      tags:
        - add team-slave
      notify:
        - restart_network
        - reload_network_interface
  handlers:
    - include: handlers/restart_network.yml
    - include: handlers/reload_network_interface.yml


